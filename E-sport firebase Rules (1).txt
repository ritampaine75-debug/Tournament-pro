{

  "rules": {

    // ADMIN can read and write to the entire database

    ".read": "root.child('adminConfig/adminUid').val() === auth.uid",

    ".write": "root.child('adminConfig/adminUid').val() === auth.uid",

    // PUBLIC read access for specific nodes that the user app needs

    "games": {

      ".read": true

    },

    "promotions": {

      ".read": true

    },

    "settings": {

      ".read": true

    },

    "notifications": {

      // Allow any logged-in user to read global notifications

      ".read": "auth != null"

    },

    "tournaments": {

      // ===== INDEXES FOR QUERYING =====

      ".indexOn": ["gameId", "status"],

      // Allow logged-in users to read tournament lists

      ".read": "auth != null",

      "$tournamentId": {

        // Allow logged-in users to read details of a specific tournament

        ".read": "auth != null",

        "registeredPlayers": {

          "$uid": {

            // A user can only write to their own registration node

            ".write": "auth != null && auth.uid === $uid"

          }

        }

      }

    },

    

    // CHAT RULES

    "chats": {

      "$tournamentId": {

        ".indexOn": "timestamp", 

        ".read": "auth != null",

        "$messageId": {

          // === YAHI LINE ADD KARNI HAI ADMIN PANEL KE LIYE ===

          ".read": "auth != null",

          

          ".write": "auth != null && (data.child('uid').val() === auth.uid || !data.exists())",

          "uid": {

            ".validate": "newData.val() === auth.uid && !data.exists()"

          },

          "message": {

            ".validate": "newData.isString() && newData.val().length > 0"

          }

        }

      }

    },

    

    // USER-SPECIFIC DATA

    "users": {

      // Allow logged-in users to query for referral codes

      ".read": "auth != null",

      "$uid": {

        // A user can read their own data

        ".read": "auth != null && auth.uid === $uid",

        // A user can only write to their own profile

        ".write": "auth != null && auth.uid === $uid",

        "notifications": {

          ".read": "auth != null && auth.uid === $uid"

        }

      },

      ".indexOn": ["referralCode", "leaderboardRank"]

    },

    "transactions": {

      "$uid": {

        ".read": "auth != null && auth.uid === $uid",

        ".write": "auth != null && auth.uid === $uid"

      }

    },

    "withdrawals": {

      ".indexOn": "status",

      // Allow any logged-in user to create a withdrawal request

      ".write": "auth != null"

    },

    "deposits": {

      ".indexOn": "status",

      // Allow any logged-in user to create a deposit request

      ".write": "auth != null"

    },

    "pendingReferrals": {

      ".indexOn": "status",

      // Allow any logged-in user (new signup) to create a pending request.

      ".write": "auth != null"

    },

    // ADMIN CONFIG

    "adminConfig": {

      // Anyone can read this to check if setup is done

      ".read": true,

      // Only allow write if it's the very first setup and the user is logged in

      ".write": "!data.exists() && auth != null"

    }

  }

}